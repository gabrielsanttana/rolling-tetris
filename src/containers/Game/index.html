<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="stylesheet" href="../../globalStyles.css" />
    <link rel="stylesheet" href="./styles.css" />
    <title>Rolling Tetris</title>
  </head>

  <body>
    <header>
      <img src="../../images/tetris-logo.png" alt="Tetris" />

      <h1>Rolling Tetris</h1>

      <nav>
        <div class="nav-item">
          <a href="../Edit/index.html">Editar perfil</a>
        </div>
        <div class="nav-item">
          <a href="../Ranking/index.html">Ranking global</a>
        </div>
        <div class="nav-item"><a href="../Login/index.html">Sair</a></div>
      </nav>
    </header>

    <main>
      <section id="gameSection">
        <header>
          <div>
            <strong>Tempo de partida: </strong><span id="gameTime">0s</span>
          </div>

          <div>
            <strong>Pontuação: </strong><span id="currentScore">0</span>
          </div>

          <div>
            <strong>Linhas eliminadas: </strong><span id="clearedLines">0</span>
          </div>

          <div>
            <strong>Dificuldade: </strong><span id="difficulty">Fácil</span>
          </div>
        </header>

        <div id="boardSizeChooser">
          <input
            type="radio"
            id="smallBoard"
            name="boardSize"
            value="small"
            checked
          />
          <label for="small">Pequeno</label><br />
          <input type="radio" id="bigBoard" name="boardSize" value="big" />
          <label for="small">Grande</label><br />
        </div>

        <div class="gameContainer">
          <canvas id="screen"></canvas>
        </div>

        <footer>
          <button type="button" id="startGameButton">Iniciar</button>
        </footer>
      </section>

      <section id="tableSection">
        <table>
          <thead>
            <tr>
              <th>Jogador</th>
              <th>Pontuação</th>
              <th>Nível atingido</th>
              <th>Duração</th>
            </tr>
          </thead>

          <tbody>
            <tr>
              <td>Vitor Prado</td>
              <td>300</td>
              <td>Médio</td>
              <td>40s</td>
            </tr>
            <tr>
              <td>Vitor Prado</td>
              <td>500</td>
              <td>Médio</td>
              <td>56s</td>
            </tr>
            <tr>
              <td>Vitor Prado</td>
              <td>100</td>
              <td>Facil</td>
              <td>10s</td>
            </tr>
          </tbody>
        </table>
      </section>
    </main>

    <script type="module">
      import createGame from '../../components/Game/game.js';
      import createKeyboardListener from '../../components/Game/keyboardListener.js';
      import createRenderScreen from '../../components/Game/renderScreen.js';

      const screen = document.getElementById('screen');
      const gameTime = document.getElementById('gameTime');
      const currentScore = document.getElementById('currentScore');
      const clearedLines = document.getElementById('clearedLines');
      const difficulty = document.getElementById('difficulty');

      const smallBoardRadio = document.getElementById('smallBoard');
      const bigBoardRadio = document.getElementById('bigBoard');
      const boardSizeChooser = document.getElementById('boardSizeChooser');

      const startGameButton = document.getElementById('startGameButton');

      const board = {
        small: {
          height: 20,
          width: 10
        },
        big: {
          height: 44,
          width: 22
        }
      };

      const game = createGame(board.small.height, board.small.width);
      let canvas = document.getElementById('screen');
      canvas.height = board.small.height;
      canvas.width = board.small.width;

      const keyboardListener = createKeyboardListener(document);
      keyboardListener.subscribe(game.moveTetrimino);

      const renderScreen = createRenderScreen(
        screen,
        game,
        requestAnimationFrame,
        currentScore,
        clearedLines,
        difficulty,
        gameTime,
        boardSizeChooser,
        startGameButton
      );

      game.subscribe(renderScreen.updateGameStatus);

      startGameButton.addEventListener('click', () => {
        game.start();
      });

      smallBoardRadio.addEventListener('click', () => {
        console.log('evento small');
        canvas.classList.remove('bigBoard');
        canvas.classList.add('smallBoard');
        canvas.height = board.small.height;
        canvas.width = board.small.width;
        game.setBoardSize(board.small.height, board.small.width);
      });
      bigBoardRadio.addEventListener('click', () => {
        console.log('evento big');
        canvas.classList.remove('smallBoard');
        canvas.classList.add('bigBoard');
        canvas.height = board.big.height;
        canvas.width = board.big.width;
        game.setBoardSize(board.big.height, board.big.width);
      });
    </script>
  </body>
</html>
